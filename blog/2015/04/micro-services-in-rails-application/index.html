

<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Micro services with Rails</title>
      <link rel="amphtml" href="https://mercury.postlight.com/amp?url=http://blog.yafoy.com/blog/2015/04/micro-services-in-rails-application/">

    <!-- <title>yafoy blog</title> -->
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/blog/feed.xml" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css"></style>
    <link href="../../../../assets/stylesheets/application.css" rel="stylesheet" type="text/css" />
    <link href='https://fonts.googleapis.com/css?family=EB+Garamond' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div class="container">
        <header>
  <a href="/"><img width="40px" src="../../../../assets/images/yafoy-mark.png" /></a>
</header>


        <article>
    <h1 class="center">Micro services with Rails</h1>
    <p>So you've heard about the new kid on the block and the need to decouple business logic in small chunks (monolithic architecture versus microservice).</p>

<p>You've heard about keeping controllers skinny and models fat, but you end up with bloated models as your application grows and needs to interact with external services such as stripe, github, twillio…</p>

<p>Here is the architecture pattern we've put in place in RoR applications when comes time to deal with APIs or process-intensive requests. One thing to note is that all business logic remains in same codebase, we're not building external services all the time. External microservices require monitoring and jumping from one project to another is not always ideal (<a href="http://blog.yafoy.com/blog/2014/04/switching-cost-in-project-management/">switching cost in PM</a>).</p>

<p><img alt="Micros services architecture in Rails application" src="assets/images/articles/micro-services-architecture.jpg" /></p>

<p><strong>Workflow</strong></p>

<ol>
  <li>Controller receives HTTP request and pass it on to the service layer</li>
  <li>Services are shared components that can be reused across the application such as FTP service, Payment service, Notification service…
Service's role is to enqueue job and that's it. At this point, the original HTTP request is considered as processed and the end user should receive confirmation "Batch customer import task is in the pipe. Please check in a few minutes). Notification happens either through the user interface or through 201 response code for example, since the whole point is to be able to use services in different parts of your application (public API or classic controller).</li>
  <li>Job/Worker is asynchronous and handled by a different beast. Usually delegated to Redis + Sidekiq but thanks to ActiveJob, sky is the limit. <a href="https://aws.amazon.com/sqs/">Amazon Simple Queue Service (SQS)</a> is another great option. Check out <a href="https://github.com/phstc/shoryuken">shoryuken gem</a> if you plan to use AWS.</li>
  <li>Finally, for code clarity, behaviour lives in models grouped by category such as carrier integration for instance, with separate models for Canada Post, DHL, Fedex and so on. All inheriting from a base model (since core actions are identical (get rates…), only carrier changes)</li>
</ol>

<p><strong>Benefits</strong></p>

<ul>
  <li>Smaller pieces = easier to test</li>
  <li>Faster response for the client</li>
  <li>If job fails you can reschedule and retry anytime. Job triggered when resources are free up</li>
  <li>Repetitive pattern</li>
  <li>Keep controllers and models light. Scalable</li>
</ul>

  </article>
  <div class="row featured-project">
  <div class="two columns">
    <a target="_blank" href="https://jolibento.com"><img width="100" src="../../../../assets/images/projects/bento.png" /></a>
  </div>
  <div class="ten columns">
    <strong>Joli Bento</strong><br>
    Traditional Bento Lunch Box from Japan
  </div>
</div>

      <!-- <aside>
      </aside> -->
    </div>
    <footer>
  <div class="container large">
    <div class="row">
      <div class="three columns">
        <ul>
          <li class="title">Products</li>
            <li><a target="_blank" href="https://log.camp/">Logcamp</a></li>
            <li><a target="_blank" href="https://centralid.herokuapp.com/">Central ID</a></li>
            <li><a target="_blank" href="https://codeguard.herokuapp.com/">Codeguard</a></li>
            <li><a target="_blank" href="https://formz.herokuapp.com/">Formtastic</a></li>
            <li><a target="_blank" href="https://shiptower.herokuapp.com/">Shiptower</a></li>
        </ul>
      </div>
      <div class="three columns">
        <ul>
          <li class="title">E-commerce</li>
            <li><a target="_blank" href="https://jolibento.com">Joli Bento</a></li>
            <li><a target="_blank" href="https://lesbonbecs.com">Les Bonbecs</a></li>
            <li><a target="_blank" href="http://tsurprise.com">T•Surprise</a></li>
        </ul>
      </div>
      <div class="three columns">
        <ul>
          <li class="title">Services</li>
          <li><a href="http://yafoy.com/en#services">Web Application Development</a></li>
          <li><a href="http://yafoy.com/en#services">Business Requirements Gathering</a></li>
        </ul>
      </div>
      <div class="three columns">
        <ul>
          <li class="title">Contact</li>
          <li><a href="http://yafoy.com/en#contact?utm_source=blog">Call us</a></li>
          <li><a href="http://yafoy.com/en#contact?utm_source=blog">Write us</a></li>
        </ul>
      </div>
    </div>
  </div>
</footer>
<div class="copyright bg-grey-light">
  <div class="container large center">
    © 2017 yafoy - Design & Copy
  </div>
</div>

    <script src="//use.typekit.net/dkj0zdv.js"></script>
<script>try{Typekit.load();}catch(e){}</script>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-714749-17', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>
